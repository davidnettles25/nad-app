<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAD Test Cycle - Component Testing</title>
    
    <!-- CORRECTED: No /nad-app/ in paths -->
    <link rel="stylesheet" href="/shared/css/base.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
        
        .component-demo {
            border: 2px dashed #ddd;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            min-height: 100px;
        }
        
        .log-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .btn-test {
            background: #17a2b8;
            margin: 5px;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .quick-fix-panel {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .quick-fix-panel h3 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .fix-commands {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß™ NAD Component Testing</h1>
            <p>Testing and debugging interface for NAD Test Cycle components</p>
            <div id="connection-status">
                <span class="status-indicator status-info"></span>
                <span>Initializing...</span>
            </div>
        </div>

        <!-- Quick Fix Panel -->
        <div class="quick-fix-panel" id="quick-fix-panel" style="display: none;">
            <h3>üîß Quick Fix Commands</h3>
            <p>Run these commands on your server to fix the detected issues:</p>
            <div class="fix-commands" id="fix-commands">
                Analyzing issues...
            </div>
            <button class="btn btn-success" onclick="copyFixCommands()">üìã Copy Commands</button>
            <button class="btn" onclick="hideQuickFix()">‚úÖ Mark as Fixed</button>
        </div>

        <div class="test-grid">
            <!-- File Structure Test -->
            <div class="test-card">
                <h3>üìÅ File Structure</h3>
                <p>Tests if required files exist and are accessible.</p>
                <div id="file-structure-status">
                    <div><span class="status-indicator status-info"></span>CSS Files: <span id="css-files-status">Testing...</span></div>
                    <div><span class="status-indicator status-info"></span>JS Files: <span id="js-files-status">Testing...</span></div>
                    <div><span class="status-indicator status-info"></span>HTML Files: <span id="html-files-status">Testing...</span></div>
                    <div><span class="status-indicator status-info"></span>Shared Assets: <span id="shared-assets-status">Testing...</span></div>
                </div>
                <button class="btn btn-test" onclick="testFileStructure()">Test Files</button>
                <button class="btn btn-success" onclick="createMissingFiles()">Create Missing</button>
            </div>

            <!-- Component System Test -->
            <div class="test-card">
                <h3>üîß Component System</h3>
                <p>Tests the basic component loading and initialization system.</p>
                <div class="component-demo" data-component="test-component" data-options='{"title": "Demo Component"}'>
                    Component will load here...
                </div>
                <button class="btn btn-test" onclick="testComponentSystem()">Test Components</button>
                <button class="btn btn-success" onclick="loadDemoComponent()">Load Demo</button>
            </div>

            <!-- API Connection Test -->
            <div class="test-card">
                <h3>üåê API Connection</h3>
                <p>Tests connection to the Node.js API backend.</p>
                <div id="api-status" class="alert alert-info">
                    Click button to test API connection...
                </div>
                <button class="btn btn-test" onclick="testAPIConnection()">Test API</button>
                <button class="btn btn-test" onclick="testDashboardStats()">Test Dashboard</button>
            </div>

            <!-- URL Routing Test -->
            <div class="test-card">
                <h3>üîó URL Routing</h3>
                <p>Tests proper URL routing and asset loading.</p>
                <div id="routing-status">
                    <div><span class="status-indicator status-info"></span>Base CSS: <span id="css-status">Testing...</span></div>
                    <div><span class="status-indicator status-info"></span>Components JS: <span id="js-status">Testing...</span></div>
                    <div><span class="status-indicator status-info"></span>Assets: <span id="assets-status">Testing...</span></div>
                    <div><span class="status-indicator status-info"></span>MIME Types: <span id="mime-status">Testing...</span></div>
                </div>
                <button class="btn btn-test" onclick="testURLRouting()">Test Routes</button>
                <button class="btn btn-test" onclick="testMimeTypes()">Test MIME</button>
            </div>

            <!-- Interface Links Test -->
            <div class="test-card">
                <h3>üéØ Interface Links</h3>
                <p>Tests navigation to main NAD interfaces.</p>
                <div id="interface-links-status">
                    <div><span class="status-indicator status-info"></span>Admin: <span id="admin-status">Testing...</span></div>
                    <div><span class="status-indicator status-info"></span>Portal: <span id="portal-status">Testing...</span></div>
                    <div><span class="status-indicator status-info"></span>Lab: <span id="lab-status">Testing...</span></div>
                    <div><span class="status-indicator status-info"></span>Test: <span id="test-interface-status">Testing...</span></div>
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
                    <a href="/admin.html" class="btn" target="_blank">üîß Admin Dashboard</a>
                    <a href="/customer-portal.html" class="btn" target="_blank">üë§ Customer Portal</a>
                    <a href="/lab-interface.html" class="btn" target="_blank">üî¨ Lab Interface</a>
                    <a href="/test-interface.html" class="btn" target="_blank">üß™ Test Interface</a>
                </div>
                <button class="btn btn-test" onclick="testAllInterfaces()">Test All Links</button>
            </div>

            <!-- System Information -->
            <div class="test-card">
                <h3>üìä System Info</h3>
                <p>Current system and environment information.</p>
                <div style="font-size: 14px; line-height: 1.8;">
                    <div><strong>Domain:</strong> <span id="current-domain">Loading...</span></div>
                    <div><strong>Protocol:</strong> <span id="current-protocol">Loading...</span></div>
                    <div><strong>Path:</strong> <span id="current-path">Loading...</span></div>
                    <div><strong>User Agent:</strong> <span id="user-agent">Loading...</span></div>
                    <div><strong>Timestamp:</strong> <span id="current-time">Loading...</span></div>
                    <div><strong>Console Errors:</strong> <span id="error-count">0</span></div>
                </div>
                <button class="btn btn-test" onclick="refreshSystemInfo()">Refresh Info</button>
                <button class="btn btn-test" onclick="generateDiagnostic()">Generate Report</button>
            </div>

            <!-- Error Testing -->
            <div class="test-card">
                <h3>‚ö†Ô∏è Error Testing</h3>
                <p>Tests error handling and debugging capabilities.</p>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <button class="btn btn-danger" onclick="test404Error()">Test 404</button>
                    <button class="btn btn-danger" onclick="testNetworkError()">Network Error</button>
                    <button class="btn btn-test" onclick="testConsoleLog()">Console Test</button>
                    <button class="btn btn-test" onclick="testCORSError()">CORS Test</button>
                </div>
            </div>
        </div>

        <!-- Console Log -->
        <div class="test-card">
            <h3>üìã Test Console</h3>
            <div class="log-output" id="test-console">
Ready for testing...
Starting component system initialization...
            </div>
            <button class="btn btn-test" onclick="clearConsole()">Clear Console</button>
            <button class="btn btn-success" onclick="exportLogs()">Export Logs</button>
            <button class="btn btn-test" onclick="toggleAutoScroll()">Toggle Auto-scroll</button>
        </div>
    </div>

    <!-- CORRECTED: No /nad-app/ in script src -->
    <script src="/shared/js/components.js"></script>
    
    <script>
        // Configuration - CORRECTED: No /nad-app/ in API base
        const API_BASE = 'https://mynadtest.info';
        
        // Global state
        let errorCount = 0;
        let autoScroll = true;
        let fixCommands = [];
        
        // Console logging system
        const testConsole = document.getElementById('test-console');
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        
        function logToConsole(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            testConsole.textContent += logEntry;
            
            if (autoScroll) {
                testConsole.scrollTop = testConsole.scrollHeight;
            }
            
            // Also log to browser console
            originalConsoleLog(`NAD Test: ${message}`);
        }
        
        // Override console.log and console.error for testing
        console.log = function(...args) {
            logToConsole(args.join(' '));
            originalConsoleLog.apply(console, args);
        };
        
        console.error = function(...args) {
            errorCount++;
            document.getElementById('error-count').textContent = errorCount;
            logToConsole(args.join(' '), 'error');
            originalConsoleError.apply(console, args);
        };
        
        // Test Functions
        async function testFileStructure() {
            logToConsole('Testing file structure...');
            
            const filesToTest = [
                { url: '/shared/css/base.css', type: 'CSS', statusId: 'css-files-status' },
                { url: '/shared/js/components.js', type: 'JS', statusId: 'js-files-status' },
                { url: '/admin.html', type: 'HTML', statusId: 'html-files-status' },
                { url: '/customer-portal.html', type: 'HTML', statusId: 'html-files-status' }
            ];
            
            for (const file of filesToTest) {
                try {
                    const response = await fetch(file.url, { method: 'HEAD' });
                    if (response.ok) {
                        updateStatus(file.statusId, '‚úÖ Found');
                        logToConsole(`‚úÖ ${file.type}: ${file.url} exists`);
                    } else {
                        updateStatus(file.statusId, `‚ùå ${response.status}`);
                        logToConsole(`‚ùå ${file.type}: ${file.url} returned ${response.status}`, 'error');
                        
                        if (response.status === 404) {
                            addFixCommand(`# Create missing file: ${file.url}`);
                            if (file.type === 'CSS') {
                                addFixCommand(`mkdir -p /opt/bitnami/apache/htdocs/shared/css`);
                                addFixCommand(`# Create ${file.url} with basic styles`);
                            } else if (file.type === 'JS') {
                                addFixCommand(`mkdir -p /opt/bitnami/apache/htdocs/shared/js`);
                                addFixCommand(`# Create ${file.url} with component system`);
                            }
                        }
                    }
                } catch (error) {
                    updateStatus(file.statusId, '‚ùå Error');
                    logToConsole(`‚ùå ${file.type}: ${file.url} failed - ${error.message}`, 'error');
                }
            }
            
            updateStatus('shared-assets-status', '‚úÖ Checked');
            
            if (fixCommands.length > 0) {
                showQuickFix();
            }
        }
        
        function testComponentSystem() {
            logToConsole('Testing component system...');
            
            if (typeof NADComponents !== 'undefined') {
                logToConsole('‚úÖ NADComponents is available');
                
                // Test component configuration
                NADComponents.config.debugMode = true;
                NADComponents.config.baseUrl = API_BASE;
                logToConsole('‚úÖ Component system configured');
                
                // Test component loading (using available loadSection method)
                NADComponents.loadSection('overview', '.component-demo')
                    .then(() => {
                        logToConsole('‚úÖ Test component loaded successfully');
                        updateStatus('js-status', '‚úÖ Working');
                    })
                    .catch(error => {
                        logToConsole('‚ùå Component loading failed: ' + error.message, 'error');
                        updateStatus('js-status', '‚ùå Failed');
                    });
            } else {
                logToConsole('‚ùå NADComponents not available - check if components.js loaded', 'error');
                updateStatus('js-status', '‚ùå Missing');
                
                addFixCommand('# Fix components.js loading issue');
                addFixCommand('# Check if file exists and has correct content');
                addFixCommand('ls -la /opt/bitnami/apache/htdocs/shared/js/components.js');
                showQuickFix();
            }
        }
        
        function loadDemoComponent() {
            logToConsole('Loading demo component...');
            
            const demoContainer = document.querySelector('[data-component="test-component"]');
            if (demoContainer && typeof NADComponents !== 'undefined') {
                const component = NADComponents.createTestComponent(
                    'Demo Component',
                    'This is a dynamically loaded test component showing the system works correctly.'
                );
                demoContainer.innerHTML = '';
                demoContainer.appendChild(component);
                logToConsole('‚úÖ Demo component loaded in container');
            } else {
                logToConsole('‚ùå Cannot load demo component - NADComponents not available', 'error');
            }
        }
        
        async function testAPIConnection() {
            logToConsole('Testing API connection...');
            const statusDiv = document.getElementById('api-status');
            
            try {
                statusDiv.className = 'alert alert-info';
                statusDiv.textContent = 'Testing API connection...';
                
                const response = await fetch(`${API_BASE}/health`);
                
                if (response.ok) {
                    const data = await response.json();
                    logToConsole('‚úÖ API connection successful');
                    statusDiv.className = 'alert alert-success';
                    statusDiv.textContent = `‚úÖ API Connected - Status: ${data.status}`;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                logToConsole('‚ùå API connection failed: ' + error.message, 'error');
                statusDiv.className = 'alert alert-error';
                statusDiv.textContent = `‚ùå API Error: ${error.message}`;
                
                addFixCommand('# Check if Node.js API is running');
                addFixCommand('pm2 status nad-api');
                addFixCommand('# If not running, start it:');
                addFixCommand('pm2 start nad-api');
                showQuickFix();
            }
        }
        
        async function testDashboardStats() {
            logToConsole('Testing dashboard stats API...');
            
            try {
                const response = await fetch(`${API_BASE}/api/dashboard/stats`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        logToConsole('‚úÖ Dashboard stats loaded successfully');
                        logToConsole(`Stats: Total tests: ${data.stats.total_tests}, Activated: ${data.stats.activated_tests}`);
                    } else {
                        throw new Error(data.error || 'Dashboard returned success: false');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                logToConsole('‚ùå Dashboard stats error: ' + error.message, 'error');
            }
        }
        
        
        function testURLRouting() {
            logToConsole('Testing URL routing...');
            
            // Test CSS loading
            const cssLinks = document.querySelectorAll('link[rel="stylesheet"]');
            logToConsole(`Found ${cssLinks.length} CSS links`);
            
            let cssWorking = false;
            cssLinks.forEach((link, index) => {
                logToConsole(`CSS ${index + 1}: ${link.href}`);
                if (link.href.includes('/shared/css/')) {
                    cssWorking = true;
                }
            });
            
            updateStatus('css-status', cssWorking ? '‚úÖ Found' : '‚ùå Missing');
            
            // Test script loading
            const scripts = document.querySelectorAll('script[src]');
            logToConsole(`Found ${scripts.length} external scripts`);
            
            let jsWorking = false;
            scripts.forEach((script, index) => {
                logToConsole(`Script ${index + 1}: ${script.src}`);
                if (script.src.includes('/shared/js/')) {
                    jsWorking = true;
                }
            });
            
            updateStatus('js-status', jsWorking ? '‚úÖ Found' : '‚ùå Missing');
            updateStatus('assets-status', '‚úÖ Checked');
        }
        
        async function testMimeTypes() {
            logToConsole('Testing MIME types...');
            
            try {
                const cssResponse = await fetch('/shared/css/base.css', { method: 'HEAD' });
                const cssContentType = cssResponse.headers.get('content-type');
                logToConsole(`CSS MIME type: ${cssContentType}`);
                
                const jsResponse = await fetch('/shared/js/components.js', { method: 'HEAD' });
                const jsContentType = jsResponse.headers.get('content-type');
                logToConsole(`JS MIME type: ${jsContentType}`);
                
                if (cssContentType && cssContentType.includes('text/css')) {
                    updateStatus('mime-status', '‚úÖ CSS OK');
                } else {
                    updateStatus('mime-status', '‚ùå CSS Wrong');
                    addFixCommand('# Fix MIME types in .htaccess');
                    addFixCommand('echo "AddType text/css .css" >> /opt/bitnami/apache/htdocs/.htaccess');
                    addFixCommand('echo "AddType application/javascript .js" >> /opt/bitnami/apache/htdocs/.htaccess');
                    showQuickFix();
                }
            } catch (error) {
                logToConsole('‚ùå MIME type test failed: ' + error.message, 'error');
                updateStatus('mime-status', '‚ùå Error');
            }
        }
        
        async function testAllInterfaces() {
            logToConsole('Testing all interface links...');
            
            const interfaces = [
                { url: '/admin.html', statusId: 'admin-status', name: 'Admin' },
                { url: '/customer-portal.html', statusId: 'portal-status', name: 'Portal' },
                { url: '/lab-interface.html', statusId: 'lab-status', name: 'Lab' },
                { url: '/test-interface.html', statusId: 'test-interface-status', name: 'Test' }
            ];
            
            for (const iface of interfaces) {
                try {
                    const response = await fetch(iface.url, { method: 'HEAD' });
                    if (response.ok) {
                        updateStatus(iface.statusId, '‚úÖ OK');
                        logToConsole(`‚úÖ ${iface.name} interface accessible`);
                    } else {
                        updateStatus(iface.statusId, `‚ùå ${response.status}`);
                        logToConsole(`‚ùå ${iface.name} interface returned ${response.status}`, 'error');
                    }
                } catch (error) {
                    updateStatus(iface.statusId, '‚ùå Error');
                    logToConsole(`‚ùå ${iface.name} interface error: ${error.message}`, 'error');
                }
            }
        }
        
        function updateStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = status;
                
                // Update status indicator
                const indicator = element.parentElement.querySelector('.status-indicator');
                if (indicator) {
                    indicator.className = 'status-indicator ' + 
                        (status.includes('‚úÖ') ? 'status-success' : 
                         status.includes('‚ùå') ? 'status-error' : 'status-warning');
                }
            }
        }
        
        function refreshSystemInfo() {
            logToConsole('Refreshing system information...');
            
            document.getElementById('current-domain').textContent = window.location.hostname;
            document.getElementById('current-protocol').textContent = window.location.protocol;
            document.getElementById('current-path').textContent = window.location.pathname;
            document.getElementById('user-agent').textContent = navigator.userAgent.substring(0, 100) + '...';
            document.getElementById('current-time').textContent = new Date().toLocaleString();
            
            logToConsole('‚úÖ System information updated');
        }
        
        function generateDiagnostic() {
            logToConsole('Generating diagnostic report...');
            
            const report = {
                timestamp: new Date().toISOString(),
                domain: window.location.hostname,
                protocol: window.location.protocol,
                path: window.location.pathname,
                userAgent: navigator.userAgent,
                errorCount: errorCount,
                apiBase: API_BASE,
                componentsLoaded: typeof NADComponents !== 'undefined',
                fixCommandsGenerated: fixCommands.length
            };
            
            const reportText = JSON.stringify(report, null, 2);
            logToConsole('Diagnostic report generated');
            
            // Create downloadable report
            const blob = new Blob([reportText], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nad-diagnostic-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        async function test404Error() {
            logToConsole('Testing 404 error handling...');
            
            try {
                const response = await fetch('/nonexistent-url-test-12345');
                logToConsole(`404 test result: ${response.status} ${response.statusText}`);
            } catch (error) {
                logToConsole('Network error during 404 test: ' + error.message, 'error');
            }
        }
        
        async function testNetworkError() {
            logToConsole('Testing network error handling...');
            
            try {
                const response = await fetch('https://nonexistent-domain-test-12345.com/api/test');
                logToConsole('Unexpected success in network error test');
            } catch (error) {
                logToConsole('‚úÖ Network error caught correctly: ' + error.message);
            }
        }
        
        async function testCORSError() {
            logToConsole('Testing CORS error handling...');
            
            try {
                const response = await fetch('https://httpbin.org/get');
                logToConsole('‚úÖ CORS test completed - external API accessible');
            } catch (error) {
                logToConsole('CORS error (expected): ' + error.message);
            }
        }
        
        function testConsoleLog() {
            logToConsole('Testing console logging system...');
            console.log('This is a test log message');
            console.warn('This is a test warning');
            console.error('This is a test error');
            logToConsole('‚úÖ Console test completed - check error count increased');
        }
        
        function clearConsole() {
            testConsole.textContent = 'Console cleared...\n';
            logToConsole('Console cleared');
        }
        
        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            logToConsole(`Auto-scroll ${autoScroll ? 'enabled' : 'disabled'}`);
        }
        
        function exportLogs() {
            const logs = testConsole.textContent;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nad-test-logs-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            logToConsole('‚úÖ Logs exported');
        }
        
        // Quick Fix System
        function addFixCommand(command) {
            if (!fixCommands.includes(command)) {
                fixCommands.push(command);
            }
        }
        
        function showQuickFix() {
            const panel = document.getElementById('quick-fix-panel');
            const commandsDiv = document.getElementById('fix-commands');
            
            commandsDiv.textContent = fixCommands.join('\n');
            panel.style.display = 'block';
            
            logToConsole(`Generated ${fixCommands.length} fix commands`);
        }
        
        function hideQuickFix() {
            document.getElementById('quick-fix-panel').style.display = 'none';
            fixCommands = [];
            logToConsole('Quick fix panel hidden');
        }
        
        function copyFixCommands() {
            const commands = fixCommands.join('\n');
            navigator.clipboard.writeText(commands).then(() => {
                logToConsole('‚úÖ Fix commands copied to clipboard');
            }).catch(() => {
                logToConsole('‚ùå Failed to copy to clipboard');
            });
        }
        
        async function createMissingFiles() {
            logToConsole('Attempting to create missing files...');
            
            // This would normally require server-side implementation
            // For now, just show the commands needed
            addFixCommand('# Run the HTML fix script to create missing files');
            addFixCommand('chmod +x html_url_fix.sh');
            addFixCommand('./html_url_fix.sh');
            
            showQuickFix();
            logToConsole('Generated commands to create missing files');
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            logToConsole('=== NAD Component Testing Started ===');
            logToConsole('DOM Content Loaded');
            
            // Update connection status
            const statusElement = document.querySelector('#connection-status span:last-child');
            statusElement.textContent = 'Connected';
            document.querySelector('#connection-status .status-indicator').className = 'status-indicator status-success';
            
            // Initialize system info
            refreshSystemInfo();
            
            // Test component system if available
            setTimeout(() => {
                if (typeof NADComponents !== 'undefined') {
                    logToConsole('‚úÖ NADComponents loaded successfully');
                    updateStatus('js-status', '‚úÖ Loaded');
                } else {
                    logToConsole('‚ö†Ô∏è NADComponents not available - this may indicate a loading issue', 'warning');
                    updateStatus('js-status', '‚ö†Ô∏è Missing');
                    
                    // Add fix commands for missing components
                    addFixCommand('# NADComponents not loaded - check these issues:');
                    addFixCommand('# 1. Verify components.js exists:');
                    addFixCommand('ls -la /opt/bitnami/apache/htdocs/shared/js/components.js');
                    addFixCommand('# 2. Check file permissions:');
                    addFixCommand('chmod 644 /opt/bitnami/apache/htdocs/shared/js/components.js');
                    addFixCommand('# 3. Verify .htaccess has correct MIME types:');
                    addFixCommand('grep -i "javascript" /opt/bitnami/apache/htdocs/.htaccess');
                    addFixCommand('# 4. If missing, run the fix script:');
                    addFixCommand('./html_url_fix.sh');
                    
                    showQuickFix();
                }
            }, 1000);
            
            // Auto-test file structure after 2 seconds
            setTimeout(() => {
                testFileStructure();
            }, 2000);
            
            logToConsole('=== Initialization Complete ===');
        });
        
        // Check CSS loading
        window.addEventListener('load', function() {
            logToConsole('Window load event fired');
            
            // Check if CSS loaded properly
            const testElement = document.createElement('div');
            testElement.className = 'btn';
            testElement.style.visibility = 'hidden';
            testElement.style.position = 'absolute';
            document.body.appendChild(testElement);
            
            const styles = window.getComputedStyle(testElement);
            const hasBackground = styles.backgroundColor !== 'rgba(0, 0, 0, 0)' && styles.backgroundColor !== 'transparent';
            const hasPadding = styles.paddingTop !== '0px';
            
            if (hasBackground || hasPadding) {
                logToConsole('‚úÖ CSS styles applied correctly');
                updateStatus('css-status', '‚úÖ Working');
            } else {
                logToConsole('‚ö†Ô∏è CSS may not be loading correctly - styles not applied', 'warning');
                updateStatus('css-status', '‚ö†Ô∏è Issues');
                
                // Add CSS fix commands
                addFixCommand('# CSS not loading properly - check these:');
                addFixCommand('# 1. Verify base.css exists:');
                addFixCommand('ls -la /opt/bitnami/apache/htdocs/shared/css/base.css');
                addFixCommand('# 2. Check MIME type configuration:');
                addFixCommand('curl -I https://mynadtest.info/shared/css/base.css');
                addFixCommand('# 3. Add MIME type to .htaccess if needed:');
                addFixCommand('echo "AddType text/css .css" >> /opt/bitnami/apache/htdocs/.htaccess');
                addFixCommand('# 4. Restart Apache:');
                addFixCommand('sudo /opt/bitnami/ctlscript.sh restart apache');
                
                showQuickFix();
            }
            
            document.body.removeChild(testElement);
            
            // Test if shared resources are loading
            testSharedResources();
        });
        
        // Test shared resources function
        async function testSharedResources() {
            logToConsole('Testing shared resource loading...');
            
            const resources = [
                { url: '/shared/css/base.css', type: 'CSS' },
                { url: '/shared/js/components.js', type: 'JavaScript' }
            ];
            
            for (const resource of resources) {
                try {
                    const response = await fetch(resource.url, { method: 'HEAD' });
                    const contentType = response.headers.get('content-type');
                    
                    if (response.ok) {
                        logToConsole(`‚úÖ ${resource.type}: ${resource.url} loads correctly (${contentType})`);
                        
                        // Check for correct MIME type
                        if (resource.type === 'CSS' && contentType && !contentType.includes('text/css')) {
                            logToConsole(`‚ö†Ô∏è ${resource.type}: Incorrect MIME type: ${contentType}`, 'warning');
                            addFixCommand(`# Fix MIME type for ${resource.url}`);
                            showQuickFix();
                        }
                        
                        if (resource.type === 'JavaScript' && contentType && !contentType.includes('javascript')) {
                            logToConsole(`‚ö†Ô∏è ${resource.type}: Incorrect MIME type: ${contentType}`, 'warning');
                            addFixCommand(`# Fix MIME type for ${resource.url}`);
                            showQuickFix();
                        }
                    } else {
                        logToConsole(`‚ùå ${resource.type}: ${resource.url} failed with ${response.status}`, 'error');
                        addFixCommand(`# Create missing file: ${resource.url}`);
                        showQuickFix();
                    }
                } catch (error) {
                    logToConsole(`‚ùå ${resource.type}: ${resource.url} network error: ${error.message}`, 'error');
                }
            }
        }
        
        // Global error handling
        window.addEventListener('error', function(event) {
            errorCount++;
            document.getElementById('error-count').textContent = errorCount;
            
            const errorMsg = `JavaScript Error: ${event.error?.message || event.message} at ${event.filename}:${event.lineno}`;
            logToConsole(`‚ùå ${errorMsg}`, 'error');
            
            // Specific error handling for common issues
            if (event.filename && event.filename.includes('/nad-app/')) {
                addFixCommand('# Found /nad-app/ URL error - run URL fix:');
                addFixCommand('./html_url_fix.sh');
                showQuickFix();
            }
            
            if (event.error?.message.includes('NADComponents')) {
                addFixCommand('# NADComponents error - check component loading:');
                addFixCommand('ls -la /opt/bitnami/apache/htdocs/shared/js/components.js');
                addFixCommand('curl -I https://mynadtest.info/shared/js/components.js');
                showQuickFix();
            }
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            errorCount++;
            document.getElementById('error-count').textContent = errorCount;
            logToConsole(`‚ùå Unhandled Promise Rejection: ${event.reason}`, 'error');
            
            // Handle API-related promise rejections
            if (event.reason && event.reason.toString().includes('fetch')) {
                addFixCommand('# API connection issue detected:');
                addFixCommand('pm2 status nad-api');
                addFixCommand('pm2 restart nad-api');
                showQuickFix();
            }
        });
        
        // Monitor for MIME type errors
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            return originalFetch.apply(this, args).then(response => {
                if (!response.ok && response.status === 404) {
                    const url = args[0];
                    if (typeof url === 'string' && url.includes('/nad-app/')) {
                        logToConsole(`‚ùå 404 Error: ${url} contains /nad-app/ path`, 'error');
                        addFixCommand('# Fix /nad-app/ URLs:');
                        addFixCommand('./html_url_fix.sh');
                        showQuickFix();
                    }
                }
                return response;
            });
        };
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Ctrl+Shift+T = Run all tests
            if (event.ctrlKey && event.shiftKey && event.key === 'T') {
                event.preventDefault();
                logToConsole('üöÄ Running all tests via keyboard shortcut...');
                testFileStructure();
                setTimeout(() => testComponentSystem(), 1000);
                setTimeout(() => testAPIConnection(), 2000);
                setTimeout(() => testAllInterfaces(), 3000);
            }
            
            // Ctrl+Shift+C = Clear console
            if (event.ctrlKey && event.shiftKey && event.key === 'C') {
                event.preventDefault();
                clearConsole();
            }
            
            // Ctrl+Shift+F = Show/hide quick fix
            if (event.ctrlKey && event.shiftKey && event.key === 'F') {
                event.preventDefault();
                const panel = document.getElementById('quick-fix-panel');
                if (panel.style.display === 'none') {
                    if (fixCommands.length === 0) {
                        addFixCommand('# No fix commands generated yet');
                        addFixCommand('# Run tests to generate specific fix commands');
                    }
                    showQuickFix();
                } else {
                    hideQuickFix();
                }
            }
        });
        
        // Add periodic health check
        setInterval(() => {
            if (typeof NADComponents === 'undefined') {
                logToConsole('üîÑ Periodic check: NADComponents still not available', 'warning');
            }
        }, 30000); // Check every 30 seconds
        
        // Performance monitoring
        const startTime = performance.now();
        window.addEventListener('load', function() {
            const loadTime = performance.now() - startTime;
            logToConsole(`üìä Page load completed in ${loadTime.toFixed(2)}ms`);
            
            if (loadTime > 5000) {
                logToConsole('‚ö†Ô∏è Slow page load detected - may indicate resource loading issues', 'warning');
            }
        });
        
        // Initial status message
        logToConsole('üéØ NAD Component Test System Ready');
        logToConsole('üí° Keyboard shortcuts: Ctrl+Shift+T (run tests), Ctrl+Shift+C (clear), Ctrl+Shift+F (toggle fixes)');
        logToConsole('üîç Monitoring for errors and generating fix commands automatically...');
    </script>
</body>
</html>
